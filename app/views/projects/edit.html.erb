<%
  #--
  #   Copyright (C) 2012-2013 Gitorious AS
  #   Copyright (C) 2009 Nokia Corporation and/or its subsidiary(-ies)
  #   Copyright (C) 2007, 2008 Johan Sørensen <johan@johansorensen.com>
  #   Copyright (C) 2008 Jonas Fonseca <fonseca@diku.dk>
  #   Copyright (C) 2008 Tor Arne Vestbø <tavestbo@trolltech.com>
  #   Copyright (C) 2009 Fabio Akita <fabio.akita@gmail.com>
  #
  #   This program is free software: you can redistribute it and/or modify
  #   it under the terms of the GNU Affero General Public License as published by
  #   the Free Software Foundation, either version 3 of the License, or
  #   (at your option) any later version.
  #
  #   This program is distributed in the hope that it will be useful,
  #   but WITHOUT ANY WARRANTY; without even the implied warranty of
  #   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  #   GNU Affero General Public License for more details.
  #
  #   You should have received a copy of the GNU Affero General Public License
  #   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  #++
  %>
<% @page_title = "Update #{project.title}" %>
<div class="gts-site-header">
  <div class="container">
    <div class="row">
      <h2 class="span"><%= t("views.projects.update_title", :link => link_to( h(project.title), project_path(project))).html_safe %></h2>
    </div>
  </div>
</div>

<div class="container">
  <div class="row-fluid">
    <div class="span8">
      <%= error_messages(project) -%>
      <%= form_for(project, {
              :as => :project,
              :url => project_path(project),
              :builder => Gitorious::View::FormBuilder,
              :html => { :class => "form-horizontal" }
            }) do |f| -%>
        <fieldset>
          <%= render(:partial => "form", :locals => {
                :form => f,
                :project => project,
                :edit_slug => false,
                :edit_urls => true
              }) -%>

          <div class="control-group">
            <label class="control-label">Merge Request Statuses:</label>
            <div class="controls gts-merge-request-statuses">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Default?</th>
                    <th>Name</th>
                    <th>State</th>
                    <th>Description</th>
                    <th>Color</th>
                    <th></th>
                  </tr>
                </thead>
                <%= f.fields_for(:merge_request_statuses) do |status_form| -%>
                  <%= render :partial => "merge_request_status_form",
                      :locals => { :form => status_form, :project_form => f } -%>
                <% end -%>
                <% content_for(:footer) do %>
                  <script src="/ui3/js/src/components/merge-request.js"></script>
                  <script>
                    gts.app.env("merge-request-status-template", "<%= escape_javascript(f.fields_for(:merge_request_statuses, MergeRequestStatus.new, :child_index => "MRSID") do |f|
                            render(:partial => "merge_request_status_form", :locals => { :form => f, :project_form => nil })
                          end) %>");

                    gts.app.feature("edit-merge-request-statuses", gts.mergeRequest.editStatuses, {
                      elements: ["gts-merge-request-statuses"],
                      depends: ["merge-request-status-template"]
                    });
                  </script>
                <% end %>
              </table>
              <div class="gts-mrs-add-ph"></div>
              <p class="help-block">
                <strong>Note</strong> that changing the name or state
                of an existing status will update all affected merge
                requests
              </p>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" type="submit"><%= t("views.projects.edit") %></button>
          </div>
        </fieldset>
      <% end %>
    </div>
    <% if Gitorious::Configuration.get("enable_sidebar_license_descriptions") %>
      <div class="span4">
        <h3>License overview</h3>
        <dl>
          <% ProjectLicense.all.each do |license| %>
            <dt><%= license.name %></dt>
            <%=raw "<dd>#{license.description}</dd>" if license.description %></dd>
          <% end %>
        </dl>
      </div>
    <% end %>
  </div>
</div>
